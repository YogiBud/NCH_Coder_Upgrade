---
title: "Untitled"
author: "Corinne Strawser"
date: "2025-02-16"
output: html_document
---

```{r}
library(DropletUtils)
library(Seurat)
library(tidyverse)
dyn.load("/igm/apps/hdf5/hdf5-1.12.1/lib/libhdf5_hl.so.200")
library("hdf5r")

dir <-
  "~/projects/scrgot/scrgot_2025/mouse_brain/rna/raw/"

files <-
  list.files(path = dir,
             pattern = ".txt.gz",
             full.names = T)

for (f in files){
  counts <- 
    read.table(gzfile(f),
               sep = "\t",
               header = T)
  sample <-
    basename(f) %>%
    gsub(".txt.gz", "", .)
  new <- 
    CreateSeuratObject(counts = counts)
  write10xCounts(paste0(dir, sample),
                 x = new@assays$RNA$counts, 
                 barcodes = colnames(new),
                 type = "sparse", 
                 version="3")
  write10xCounts(paste0(dir, sample,"/filtered_feature_bc_matrix.h5"),
                 new@assays$RNA$counts, 
                 type = "HDF5")
}
```

